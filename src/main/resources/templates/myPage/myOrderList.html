<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoonShop - 주문내역</title>
    
    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- 기존 CSS 먼저 로드 -->
    <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet">
    <link th:href="@{/css/font-awesome.min.css}" rel="stylesheet">
    <link th:href="@{/css/elegant-icons.css}" rel="stylesheet">
    <link th:href="@{/css/jquery-ui.min.css}" rel="stylesheet">
    <link th:href="@{/css/magnific-popup.css}" rel="stylesheet">
    <link th:href="@{/css/owl.carousel.min.css}" rel="stylesheet">
    <link th:href="@{/css/slicknav.min.css}" rel="stylesheet">
    <link th:href="@{/css/style.css}" rel="stylesheet">
    
    <!-- Custom CSS (마지막에 로드) -->
    <link th:href="@{/css/myPage/myOrder.css}" rel="stylesheet">
    <link th:href="@{/css/common/side.css}" rel="stylesheet">
</head>

<body>
    <!-- Header Section -->
    <th:block th:replace="common/header :: headFragment"></th:block>
    
    <!-- SideBar Section -->
    <th:block th:replace="common/side :: sideFragment"></th:block>
    
    <!-- 주문내역 페이지 시작 - CSS 범위 제한 -->
    <div class="order-page">
        
        <!-- Breadcrumb -->
        <nav class="breadcrumb-container">
            <ul class="breadcrumb">
                <li><a href="/"><i class="fas fa-home"></i></a></li>
                <li><a href="/myPage/myPage">마이페이지</a></li>
                <li class="active">주문내역</li>
            </ul>
        </nav>
        
        <!-- Order Container -->
        <main class="order-container">
            <div class="order-header">
                <h1>주문내역</h1>
                <p class="order-count" th:text="${#lists.size(myOrderList?.content ?: {})} + '건의 주문'">0건의 주문</p>
            </div>
            
            <!-- Empty Orders -->
            <div class="empty-orders" th:if="${myOrderList == null || myOrderList.totalPages == 0}">
                <div class="empty-orders-icon">
                    <i class="fas fa-receipt"></i>
                </div>
                <h2>주문 내역이 없습니다</h2>
                <p>첫 주문을 시작해보세요!</p>
                <a href="/main" class="btn btn-primary">쇼핑 시작하기</a>
            </div>
            
            <!-- Order Items -->
            <div class="order-content" th:unless="${myOrderList == null || myOrderList.totalPages == 0}">
                
                <!-- Order List -->
                <div class="order-list">
                    <div class="order-item" th:each="order, i : ${myOrderList}">
                        <!-- Order Date & Status -->
                        <div class="order-item-header">
                            <div class="order-date">
                                <i class="fas fa-calendar-alt"></i>
                                <span th:text="${#temporals.format(order.orderDate, 'yyyy.MM.dd')}">2024.01.01</span>
                            </div>
                            <div class="order-status" th:classappend="${order.orderStsType.name}">
                                <span th:text="${order.orderStsType.value}">배송완료</span>
                            </div>
                        </div>
                        
                        <!-- Product Info -->
                        <div class="product-section">
                            <!-- Product Image -->
                            <div class="product-image">
                                <img th:src="'/fileDownload?fileSeq=' + ${order.productStock.product.productFileList[0].file.fileSeq}" 
                                     alt="Product Image">
                            </div>
                            
                            <!-- Product Details -->
                            <div class="product-details">
                                <h3 class="product-name" th:text="${order.productStock.product.productName}">상품명</h3>
                                <div class="product-options">
                                    <span class="product-size">사이즈: <strong th:text="${order.productStock.productSize}">M</strong></span>
                                    <span class="product-quantity">수량: <strong th:text="${order.quantity}">1</strong>개</span>
                                </div>
                                <div class="product-price">
                                    <span th:text="${#numbers.formatDecimal(order.productStock.product.price * order.quantity, 0, 'COMMA', 0, 'POINT')} + '원'">
                                        20,000원
                                    </span>
                                </div>
                            </div>
                            
                            <!-- Action Buttons -->
                            <div class="order-actions">
                                <a href="/myPage/getMyProductInfo?productSeq=0" class="btn btn-outline btn-sm">
                                    <i class="fas fa-truck"></i>
                                    배송조회
                                </a>
                                
                                <!-- 주문 상태에 따른 액션 버튼 -->
                                <div th:if="${order.orderStsType.name == 'ORDER_COMPLETE'}" class="action-btn">
                                    <button type="button" 
                                            th:data-payment-seq="${order.payment.paymentSeq}"
                                            class="btn btn-warning btn-sm refund-btn"
                                            onclick="refundPayment(this.getAttribute('data-payment-seq'))">
                                        <i class="fas fa-times"></i>
                                        결제취소
                                    </button>
                                </div>
                                
                                <div th:if="${order.orderStsType.name == 'DELIVERY_COMPLETE'}" class="action-btn">
                                    <a th:href="'/myPage/myReviewInfo?orderInfoSeq=' + ${order.orderInfoSeq} + '&productSeq=' + ${order.productStock.product.productSeq} + '&sizeType=' + ${order.productStock.productSize}" 
                                       class="btn btn-primary btn-sm">
                                        <i class="fas fa-star"></i>
                                        리뷰작성
                                    </a>
                                </div>
                                
                                <a th:href="'/product/productInfo?productSeq=' + ${order.productStock.product.productSeq}" 
                                   class="btn btn-secondary btn-sm">
                                    <i class="fas fa-shopping-cart"></i>
                                    재주문
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Pagination -->
                <div class="pagination-container" th:if="${myOrderList.totalPages > 1}">
                    <nav class="pagination">
                        <a th:if="${myOrderList.hasPrevious()}" 
                           th:href="@{/myPage/myOrderList(page=${myOrderList.number})}"
                           class="page-btn prev">
                            <i class="fas fa-chevron-left"></i>
                        </a>
                        
                        <a th:each="page : ${#numbers.sequence(1, myOrderList.totalPages)}"
                           th:href="@{/myPage/myOrderList(page=${page})}"
                           th:class="${myOrderList.number+1 == page ? 'page-btn current' : 'page-btn'}"
                           th:text="${page}">1</a>
                        
                        <a th:if="${myOrderList.hasNext()}" 
                           th:href="@{/myPage/myOrderList(page=${myOrderList.number+2})}"
                           class="page-btn next">
                            <i class="fas fa-chevron-right"></i>
                        </a>
                    </nav>
                </div>
            </div>
        </main>
    </div>
    <!-- 주문내역 페이지 끝 -->
    
    <!-- Footer Section -->
    <th:block th:replace="common/footer :: footFragment"></th:block>
    
    <!-- Scripts -->
    <script type="text/javascript" th:src="@{/js/jquery-3.3.1.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/bootstrap.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/jquery.magnific-popup.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/jquery-ui.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/mixitup.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/jquery.countdown.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/jquery.slicknav.js}"></script>
    <script type="text/javascript" th:src="@{/js/owl.carousel.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/jquery.nicescroll.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/main.js}"></script>
    <script type="text/javascript" th:src="@{/js/myPage/myOrderInfo.js}"></script>
    <script type="text/javascript" th:src="@{/js/common/side.js}"></script>
</body>

</html>